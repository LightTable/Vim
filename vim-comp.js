(function(m){"object"==typeof exports&&"object"==typeof module?m(require("../lib/codemirror"),require("../addon/search/searchcursor"),require("../addon/dialog/dialog"),require("../addon/edit/matchbrackets.js")):"function"==typeof define&&define.amd?define(["../lib/codemirror","../addon/search/searchcursor","../addon/dialog/dialog","../addon/edit/matchbrackets"],m):m(CodeMirror)})(function(m){var F=[{keys:["<Left>"],type:"keyToKey",toKeys:["h"]},{keys:["<Right>"],type:"keyToKey",toKeys:["l"]},{keys:["<Up>"],
type:"keyToKey",toKeys:["k"]},{keys:["<Down>"],type:"keyToKey",toKeys:["j"]},{keys:["<Space>"],type:"keyToKey",toKeys:["l"]},{keys:["<BS>"],type:"keyToKey",toKeys:["h"]},{keys:["<C-Space>"],type:"keyToKey",toKeys:["W"]},{keys:["<C-BS>"],type:"keyToKey",toKeys:["B"]},{keys:["<S-Space>"],type:"keyToKey",toKeys:["w"]},{keys:["<S-BS>"],type:"keyToKey",toKeys:["b"]},{keys:["<C-n>"],type:"keyToKey",toKeys:["j"]},{keys:["<C-p>"],type:"keyToKey",toKeys:["k"]},{keys:["<C-[>"],type:"keyToKey",toKeys:["<Esc>"]},
{keys:["<C-c>"],type:"keyToKey",toKeys:["<Esc>"]},{keys:["s"],type:"keyToKey",toKeys:["c","l"],context:"normal"},{keys:["s"],type:"keyToKey",toKeys:["x","i"],context:"visual"},{keys:["S"],type:"keyToKey",toKeys:["c","c"],context:"normal"},{keys:["S"],type:"keyToKey",toKeys:["d","c","c"],context:"visual"},{keys:["<Home>"],type:"keyToKey",toKeys:["0"]},{keys:["<End>"],type:"keyToKey",toKeys:["$"]},{keys:["<PageUp>"],type:"keyToKey",toKeys:["<C-b>"]},{keys:["<PageDown>"],type:"keyToKey",toKeys:["<C-f>"]},
{keys:["<CR>"],type:"keyToKey",toKeys:["j","^"],context:"normal"},{keys:["H"],type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:["M"],type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:["L"],type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:["h"],type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:["l"],type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:["j"],
type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:["k"],type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:["g","j"],type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:["g","k"],type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:["w"],type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:["W"],type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:["e"],
type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:["E"],type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:["b"],type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:["B"],type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:["g","e"],type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:["g","E"],type:"motion",motion:"moveByWords",
motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:["{"],type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:["}"],type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:["<C-f>"],type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:["<C-b>"],type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:["<C-d>"],type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:["<C-u>"],
type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:["g","g"],type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:["G"],type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:["0"],type:"motion",motion:"moveToStartOfLine"},{keys:["^"],type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["+"],type:"motion",motion:"moveByLines",
motionArgs:{forward:!0,toFirstChar:!0}},{keys:["-"],type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:["_"],type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:["$"],type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:["%"],type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:["f","character"],type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:["F",
"character"],type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:["t","character"],type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:["T","character"],type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:[";"],type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:[","],type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:["'","character"],type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0,
linewise:!0}},{keys:["`","character"],type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:["]","`"],type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:["[","`"],type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:["]","'"],type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:["[","'"],type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:["]","p"],type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,
matchIndent:!0}},{keys:["[","p"],type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:["]","character"],type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:["[","character"],type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:["|"],type:"motion",motion:"moveToColumn",motionArgs:{}},{keys:["o"],type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{},context:"visual"},{keys:["d"],type:"operator",
operator:"delete"},{keys:["y"],type:"operator",operator:"yank"},{keys:["c"],type:"operator",operator:"change"},{keys:[">"],type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:["<"],type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:["g","~"],type:"operator",operator:"swapcase"},{keys:["n"],type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:["N"],type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:["x"],type:"operatorMotion",
operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:["X"],type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:["D"],type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},operatorMotionArgs:{visualLine:!0}},{keys:["Y"],type:"operatorMotion",operator:"yank",motion:"moveToEol",motionArgs:{inclusive:!0},operatorMotionArgs:{visualLine:!0}},
{keys:["C"],type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},operatorMotionArgs:{visualLine:!0}},{keys:["~"],type:"operatorMotion",operator:"swapcase",operatorArgs:{shouldMoveCursor:!0},motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:["<C-i>"],type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:["<C-o>"],type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:["<C-e>"],type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},
{keys:["<C-y>"],type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:["a"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"}},{keys:["A"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"}},{keys:["A"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:["i"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"}},{keys:["I"],type:"action",
action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"}},{keys:["o"],type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0}},{keys:["O"],type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1}},{keys:["v"],type:"action",action:"toggleVisualMode"},{keys:["V"],type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:["g","v"],type:"action",action:"reselectLastSelection"},
{keys:["J"],type:"action",action:"joinLines",isEdit:!0},{keys:["p"],type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:["P"],type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:["r","character"],type:"action",action:"replace",isEdit:!0},{keys:["@","character"],type:"action",action:"replayMacro"},{keys:["q","character"],type:"action",action:"enterMacroRecordMode"},{keys:["R"],type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0}},
{keys:["u"],type:"action",action:"undo"},{keys:["u"],type:"action",action:"changeCase",actionArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:["U"],type:"action",action:"changeCase",actionArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:["<C-r>"],type:"action",action:"redo"},{keys:["m","character"],type:"action",action:"setMark"},{keys:['"',"character"],type:"action",action:"setRegister"},{keys:["z","z"],type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:["z","."],type:"action",
action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["z","t"],type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:["z","<CR>"],type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:["z","-"],type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:["z","b"],type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},
{keys:["."],type:"action",action:"repeatLastEdit"},{keys:["<C-a>"],type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:["<C-x>"],type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:["a","character"],type:"motion",motion:"textObjectManipulation"},{keys:["i","character"],type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:["/"],type:"search",searchArgs:{forward:!0,querySrc:"prompt",
toJumplist:!0}},{keys:["?"],type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:["*"],type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:["#"],type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:["g","*"],type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:["g","#"],type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},
{keys:[":"],type:"ex"}],p=m.Pos,aa=function(){function na(a,b){var c=a.state.vim;if(!c.insertMode&&!c.exMode){var c=b.ranges[0].head,d=b.ranges[0].anchor;if(c.ch&&c.ch==a.doc.getLine(c.line).length){var e=p(c.line,c.ch-1);b.update([{anchor:u(c,d)?e:d,head:e}])}}}function oa(a){var b=a.state.vim;b.onPasteFn||(b.onPasteFn=function(){b.insertMode||(a.setCursor(S(a.getCursor(),0,1)),ca.enterInsertMode(a,{},b))});return b.onPasteFn}function da(a,b){for(var c=[],d=a;d<a+b;d++)c.push(String.fromCharCode(d));
return c}function pa(a,b){return b>=a.firstLine()&&b<=a.lastLine()}function O(a){return/^[A-Z]$/.test(a)}function ea(a,b){for(var c=0;c<b.length;c++)if(b[c]==a)return!0;return!1}function qa(a,b,c){if(void 0===b)throw Error("defaultValue is required");c||(c="string");G[a]={type:c,defaultValue:b};fa(a,b)}function fa(a,b){var c=G[a];if(!c)throw Error("Unknown option: "+a);if("boolean"==c.type){if(b&&!0!==b)throw Error("Invalid argument: "+a+"="+b);!1!==b&&(b=!0)}c.value="boolean"==c.type?!!b:b}function T(a){var b=
G[a];if(!b)throw Error("Unknown option: "+a);return b.value}function ra(){this.latestRegister=void 0;this.isRecording=this.isPlaying=!1;this.replaySearchQueries=[];this.onRecordingDone=void 0;this.lastInsertModeChanges=sa()}function ga(a){a.state.vim||(a.state.vim={inputState:new U,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},insertMode:!1,insertModeRepeat:void 0,visualMode:!1,visualLine:!1,lastSelection:null});return a.state.vim}function ta(){q=
{searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:void 0,jumpList:Pa(),macroModeState:new ra,lastChararacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new ua({})};for(var a in G){var b=G[a];b.value=b.defaultValue}}function U(){this.prefixRepeat=[];this.motionRepeat=[];this.motionArgs=this.motion=this.operatorArgs=this.operator=null;this.keyBuffer=[];this.registerName=null}function P(a,b){a.state.vim.inputState=new U;m.signal(a,"vim-command-done",b)}function C(a,
b){this.clear();this.keyBuffer=[a||""];this.insertModeChanges=[];this.searchQueries=[];this.linewise=!!b}function ua(a){this.registers=a;this.unnamedRegister=a['"']=new C;a["."]=new C;a[":"]=new C}function H(a,b,c){var d=Math.min(Math.max(a.firstLine(),b.line),a.lastLine());a=w(a,d)-1;a=c?a+1:a;b=Math.min(Math.max(0,b.ch),a);return p(d,b)}function V(a){var b={},c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b}function S(a,b,c){return p(a.line+b,a.ch+c)}function Qa(a,b){for(var c=0;c<a.length;c++)if(a[c]!=
b[c]&&"character"!=b[c])return!1;return!0}function va(a,b,c){return function(){for(var d=0;d<c;d++)b(a)}}function z(a){return p(a.line,a.ch)}function u(a,b){return a.ch==b.ch&&a.line==b.line}function s(a,b){return a.line<b.line||a.line==b.line&&a.ch<b.ch?!0:!1}function wa(a,b,c){a=s(a,b);b=s(b,c);return a&&b}function w(a,b){return a.getLine(b).length}function ha(a){return a.trim?a.trim():a.replace(/^\s+|\s+$/g,"")}function xa(a,b){var c=a.getCursor("anchor"),d=a.getCursor("head"),e=b.lastSelection;
if(b.visualMode)s(d,c)?(e=c,c=d,d=e):d=a.clipPos(p(d.line,d.ch+1)),x(a);else{var f=e.curEnd.line-e.curStart.line,g=f?e.curEnd.ch:e.curEnd.ch-e.curStart.ch,d={line:d.line+f,ch:f?d.ch:g+d.ch};if(e.visualLine)return[{line:c.line,ch:0},{line:d.line,ch:w(a,d.line)}]}return[c,d]}function x(a){a.off("mousedown",x);var b=a.state.vim;b.lastSelection={curStart:b.marks["<"].find(),curEnd:b.marks[">"].find(),visualMode:b.visualMode,visualLine:b.visualLine};b.visualMode=!1;b.visualLine=!1;var b=a.getCursor("anchor"),
c=a.getCursor("head");u(b,c)||a.setCursor(H(a,c));m.signal(a,"vim-mode-change",{mode:"normal"})}function v(a){if(!a)return 0;var b=a.search(/\S/);return-1==b?a.length:b}function W(a,b,c,d,e){c=a.getCursor();a=a.getLine(c.line);var f=c.ch,g=a.substring(f);e=e?g.search(/\w/):g.search(/\S/);if(-1==e)return null;f+=e;g=a.substring(f);e=a.substring(0,f);var k;k=d?/^\S+/:/\w/.test(a.charAt(f))?/^\w+/:/^[^\w\s]+/;g=k.exec(g);d=f;f+=g[0].length;e=e.split("").reverse().join("");(k=k.exec(e))&&(d-=k[0].length);
b&&(b=a.substring(f).match(/^\s*/)[0].length,0<b?f+=b:(b=e.substring(e.length-d).match(/^\s*/)[0].length,d-=b));return{start:p(c.line,d),end:p(c.line,f)}}function ya(a,b){q.lastChararacterSearch.increment=a;q.lastChararacterSearch.forward=b.forward;q.lastChararacterSearch.selectedCharacter=b.selectedCharacter}function ia(a,b,c,d){for(var e=a.getCursor(),f=e.ch,g,k=0;k<b;k++){g=a.getLine(e.line);var h=d,l=void 0;g=l=c?g.indexOf(h,f+1):g.lastIndexOf(h,f-1);if(-1==g)return null;f=g}return p(a.getCursor().line,
g)}function Q(a,b,c,d){ea(c,Ra)&&(b.marks[c]&&b.marks[c].clear(),b.marks[c]=a.setBookmark(d))}function za(){}function D(a){a=a.state.vim;return a.searchState_||(a.searchState_=new za)}function Aa(a){for(var b=!1,c=[],d=0;d<a.length;d++){var e=a.charAt(d);b||"/"!=e||c.push(d);b=!b&&"\\"==e}return c}function t(a,b){a.openNotification?a.openNotification('<span style="color: red">'+b+"</span>",{bottom:!0,duration:5E3}):alert(b)}function X(a,b){var c=(b.prefix||"")+" "+(b.desc||""),d;d=b.prefix;var e=
b.desc,f="";d&&(f+='<span style="font-family: monospace">'+d+"</span>");f+='<input type="text"/> <span style="color: #888">';e&&(f=f+'<span style="color: #888">'+e,f+="</span>");d=f;e=b.onClose;a.openDialog?a.openDialog(d,e,{bottom:!0,value:b.value,onKeyDown:b.onKeyDown,onKeyUp:b.onKeyUp}):e(prompt(c,""))}function Y(a,b,c,d){if(b){var e=D(a),f;c=!!c;d=!!d;if(b instanceof RegExp)f=b;else{var g=Aa(b),k;g.length?(k=b.substring(0,g[0]),f=-1!=b.substring(g[0]).indexOf("i")):k=b;if(k){if(!T("pcre")){b=
k;g=!1;k=[];for(var h=-1;h<b.length;h++){var l=b.charAt(h)||"",B=b.charAt(h+1)||"",r=B&&-1!="|(){".indexOf(B);g?("\\"===l&&r||k.push(l),g=!1):"\\"===l?(g=!0,B&&-1!="}".indexOf(B)&&(r=!0),r&&"\\"!==B||k.push(l)):(k.push(l),r&&"\\"!==B&&k.push("\\"))}k=k.join("")}d&&(c=/^[^A-Z]*$/.test(k));f=new RegExp(k,c||f?"i":void 0)}else f=null}if(f){Ba(a,f);a:if(a=e.getQuery(),f instanceof RegExp&&a instanceof RegExp){c=["global","multiline","ignoreCase","source"];for(d=0;d<c.length;d++)if(b=c[d],f[b]!==a[b]){a=
!1;break a}a=!0}else a=!1;if(a)return f;e.setQuery(f);return f}}}function Sa(a){if("^"==a.source.charAt(0))var b=!0;return{token:function(c){if(b&&!c.sol())c.skipToEnd();else{var d=c.match(a,!1);if(d){if(0==d[0].length)return c.next(),"searching";if(!c.sol()&&(c.backUp(1),!a.exec(c.next()+d[0])))return c.next(),null;c.match(a);return"searching"}for(;!c.eol()&&(c.next(),!c.match(a,!1)););}},query:a}}function Ba(a,b){var c=D(a).getOverlay();c&&b==c.query||(c&&a.removeOverlay(c),c=Sa(b),a.addOverlay(c),
D(a).setOverlay(c))}function Ca(a,b,c,d){void 0===d&&(d=1);return a.operation(function(){for(var e=a.getCursor(),f=a.getSearchCursor(c,e),g=0;g<d;g++){var k=f.find(b);0==g&&k&&u(f.from(),e)&&(k=f.find(b));if(!k&&(f=a.getSearchCursor(c,b?p(a.lastLine()):p(a.firstLine(),0)),!f.find(b)))return}return f.from()})}function ja(a){a.removeOverlay(D(a).getOverlay());D(a).setOverlay(null)}function ka(a){var b=a.getScrollInfo(),c=a.coordsChar({left:0,top:6+b.top},"local");a=a.coordsChar({left:0,top:b.clientHeight-
10+b.top},"local");return{top:c.line,bottom:a.line}}function R(a){for(var b,c,d=[];a;){c=/<\w+-.+?>|<\w+>|./.exec(a);if(null===c)break;b=c[0];a=a.substring(c.index+b.length);d.push(b)}return d}function Ta(a,b,c,d,e,f,g){function k(){a.operation(function(){for(;!n;)h(),l();B()})}function h(){var b=a.getRange(e.from(),e.to()).replace(f,g);e.replace(b)}function l(){if(e.findNext()){var b;b=e.from();"number"!=typeof b&&(b=b.line);b=c instanceof Array?ea(b,c):d?b>=c&&b<=d:b==c;b?(a.scrollIntoView(e.from(),
30),a.setSelection(e.from(),e.to()),p=e.from(),n=!1):n=!0}else n=!0}function B(b){b&&b();a.focus();p&&(a.setCursor(p),b=a.state.vim,b.exMode=!1,b.lastHPos=b.lastHSPos=p.ch)}function r(b,c,d){m.e_stop(b);switch(m.keyName(b)){case "Y":h();l();break;case "N":l();break;case "A":a.operation(k);break;case "L":h();case "Q":case "Esc":case "Ctrl-C":case "Ctrl-[":B(d)}n&&B(d)}a.state.vim.exMode=!0;var n=!1,p=e.from();l();n?t(a,"No matches for "+f.source):b?X(a,{prefix:"replace with <strong>"+g+"</strong> (y/n/a/q/l)",
onKeyDown:r}):k()}function K(a){var b=a.state.vim,c=q.macroModeState,d=q.registerController.getRegister("."),e=c.isPlaying;e||(a.off("change",Da),m.off(a.getInputField(),"keydown",Ea));!e&&1<b.insertModeRepeat&&(Fa(a,b,b.insertModeRepeat-1,!0),b.lastEditInputState.repeatOverride=b.insertModeRepeat);delete b.insertModeRepeat;b.insertMode=!1;a.setCursor(a.getCursor().line,a.getCursor().ch-1);a.setOption("keyMap","vim");a.setOption("disableInput",!0);a.toggleOverwrite(!1);d.setText(c.lastInsertModeChanges.changes.join(""));
m.signal(a,"vim-mode-change",{mode:"normal"});c.isRecording&&(c.isPlaying||(a=q.registerController.getRegister(c.latestRegister))&&a.pushInsertModeChanges(c.lastInsertModeChanges))}function Ga(a,b){if(!a.isPlaying){var c=q.registerController.getRegister(a.latestRegister);c&&c.pushText(b)}}function Da(a,b){var c=q.macroModeState,d=c.lastInsertModeChanges;if(!c.isPlaying)for(;b;){d.expectCursorActivityForChange=!0;if("+input"==b.origin||"paste"==b.origin||void 0===b.origin)c=b.text.join("\n"),d.changes.push(c);
b=b.next}}function Ha(a){var b=a.state.vim;b.insertMode?(a=q.macroModeState,a.isPlaying||(a=a.lastInsertModeChanges,a.expectCursorActivityForChange?a.expectCursorActivityForChange=!1:a.changes=[])):"*mouse"==a.doc.history.lastSelOrigin&&(b.lastHPos=a.doc.getCursor().ch)}function la(a){this.keyName=a}function Ea(a){function b(){c.changes.push(new la(d));return!0}var c=q.macroModeState.lastInsertModeChanges,d=m.keyName(a);-1==d.indexOf("Delete")&&-1==d.indexOf("Backspace")||m.lookupKey(d,["vim-insert"],
b)}function Fa(a,b,c,d){function e(){k?L.processAction(a,b,b.lastEditActionCommand):L.evalInput(a,b)}function f(c){if(0<g.lastInsertModeChanges.changes.length){c=b.lastEditActionCommand?c:1;var d=g.lastInsertModeChanges;g.lastInsertModeChanges={};Ia(a,d.changes,c);g.lastInsertModeChanges=d}}var g=q.macroModeState;g.isPlaying=!0;var k=!!b.lastEditActionCommand,h=b.inputState;b.inputState=b.lastEditInputState;if(k&&b.lastEditActionCommand.interlaceInsertRepeat)for(var l=0;l<c;l++)e(),f(1);else d||e(),
f(c);b.inputState=h;b.insertMode&&!d&&K(a);g.isPlaying=!1}function Ia(a,b,c){function d(b){if("string"==typeof b)m.commands[b](a);else b(a);return!0}for(var e=0;e<c;e++)for(var f=0;f<b.length;f++){var g=b[f];if(g instanceof la)m.lookupKey(g.keyName,["vim-insert"],d);else{var k=a.getCursor();a.replaceRange(g,k,k)}}}m.defineOption("vimMode",!1,function(a,b){b?(a.setOption("keyMap","vim"),a.setOption("disableInput",!0),m.signal(a,"vim-mode-change",{mode:"normal"}),a.on("beforeSelectionChange",na),a.on("cursorActivity",
Ha),ga(a),m.on(a.getInputField(),"paste",oa(a))):a.state.vim&&(a.setOption("keyMap","default"),a.setOption("disableInput",!1),a.off("beforeSelectionChange",na),a.off("cursorActivity",Ha),m.off(a.getInputField(),"paste",oa(a)),a.state.vim=null)});var Ja=/[\d]/,Ua=[/\w/,/[^\w\s]/],Va=[/\S/],Z=da(65,26),ma=da(97,26),$=da(48,10),Ka="~`!@#$%^&*()_-+=[{}]\\|/?.,<>:;\"'".split(""),La="Left Right Up Down Space Backspace Esc Home End PageUp PageDown Enter".split(" "),Ra=[].concat(Z,ma,$,["<",">"]),Wa=[].concat(Z,
ma,$,["-",'"',".",":"]),G={},Pa=function(){var a=-1,b=0,c=0,d=Array(100);return{cachedCursor:void 0,add:function(e,f,g){function k(b){var c=++a%100,f=d[c];f&&f.clear();d[c]=e.setBookmark(b)}var h=d[a%100];h?(h=h.find())&&!u(h,f)&&k(f):k(f);k(g);b=a;c=a-100+1;0>c&&(c=0)},move:function(e,f){a+=f;a>b?a=b:a<c&&(a=c);var g=d[(100+a)%100];if(g&&!g.find()){var k=0<f?1:-1,h,l=e.getCursor();do if(a+=k,(g=d[(100+a)%100])&&(h=g.find())&&!u(l,h))break;while(a<b&&a>c)}return g}}},sa=function(a){return a?{changes:a.changes,
expectCursorActivityForChange:a.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}};ra.prototype={exitMacroRecordMode:function(){var a=q.macroModeState;a.onRecordingDone();a.onRecordingDone=void 0;a.isRecording=!1},enterMacroRecordMode:function(a,b){var c=q.registerController.getRegister(b);c&&(c.clear(),this.latestRegister=b,this.onRecordingDone=function(){},this.isRecording=!0)}};var q,Xa={buildKeyMap:function(){},getRegisterController:function(){return q.registerController},
resetVimGlobalState_:ta,getVimGlobalState_:function(){return q},maybeInitVimState_:ga,InsertModeKey:la,map:function(a,b,c){I.map(a,b,c)},setOption:fa,getOption:T,defineOption:qa,defineEx:function(a,b,c){if(0!==a.indexOf(b))throw Error('(Vim.defineEx) "'+b+'" is not a prefix of "'+a+'", command not registered');Ma[a]=c;I.commandMap_[b]={name:a,shortName:b,type:"api"}},handleKey:function(a,b){var c,d=ga(a),e=q.macroModeState;if(e.isRecording&&"q"==b)e.exitMacroRecordMode(),P(a);else if("<Esc>"==b)P(a),
d.visualMode&&x(a);else{d.visualMode||u(a.getCursor("head"),a.getCursor("anchor"))||(d.visualMode=!0,d.visualLine=!1,m.signal(a,"vim-mode-change",{mode:"visual"}),a.on("mousedown",x));if("0"!=b||"0"==b&&0===d.inputState.getRepeat())c=L.matchCommand(b,F,d);if(c)if("keyToKey"==c.type)for(d=0;d<c.toKeys.length;d++)this.handleKey(a,c.toKeys[d]);else e.isRecording&&Ga(e,b),L.processCommand(a,d,c);else Ja.test(b)&&d.inputState.pushRepeatDigit(b),e.isRecording&&Ga(e,b)}},handleEx:function(a,b){I.processCommand(a,
b)}};U.prototype.pushRepeatDigit=function(a){this.operator?this.motionRepeat=this.motionRepeat.concat(a):this.prefixRepeat=this.prefixRepeat.concat(a)};U.prototype.getRepeat=function(){var a=0;if(0<this.prefixRepeat.length||0<this.motionRepeat.length)a=1,0<this.prefixRepeat.length&&(a*=parseInt(this.prefixRepeat.join(""),10)),0<this.motionRepeat.length&&(a*=parseInt(this.motionRepeat.join(""),10));return a};C.prototype={setText:function(a,b){this.keyBuffer=[a||""];this.linewise=!!b},pushText:function(a,
b){b&&(this.linewise||this.keyBuffer.push("\n"),this.linewise=!0);this.keyBuffer.push(a)},pushInsertModeChanges:function(a){this.insertModeChanges.push(sa(a))},pushSearchQuery:function(a){this.searchQueries.push(a)},clear:function(){this.keyBuffer=[];this.insertModeChanges=[];this.searchQueries=[];this.linewise=!1},toString:function(){return this.keyBuffer.join("")}};ua.prototype={pushText:function(a,b,c,d){d&&"\n"==c.charAt(0)&&(c=c.slice(1)+"\n");d&&"\n"!==c.charAt(c.length-1)&&(c+="\n");var e=
this.isValidRegister(a)?this.getRegister(a):null;if(e)O(a)?e.pushText(c,d):e.setText(c,d),this.unnamedRegister.setText(e.toString(),d);else{switch(b){case "yank":this.registers["0"]=new C(c,d);break;case "delete":case "change":-1==c.indexOf("\n")?this.registers["-"]=new C(c,d):(this.shiftNumericRegisters_(),this.registers["1"]=new C(c,d))}this.unnamedRegister.setText(c,d)}},getRegister:function(a){if(!this.isValidRegister(a))return this.unnamedRegister;a=a.toLowerCase();this.registers[a]||(this.registers[a]=
new C);return this.registers[a]},isValidRegister:function(a){return a&&ea(a,Wa)},shiftNumericRegisters_:function(){for(var a=9;2<=a;a--)this.registers[a]=this.getRegister(""+(a-1))}};var L={matchCommand:function(a,b,c){function d(b){if(f.length<b.keys.length)return e.keyBuffer.push(a),null;"character"==b.keys[f.length-1]&&(e.selectedCharacter=k);e.keyBuffer=[];return b}for(var e=c.inputState,f=e.keyBuffer.concat(a),g=[],k,h=0;h<b.length;h++){var l=b[h];if(Qa(f,l.keys)&&(!e.operator||"action"!=l.type)){if("character"==
l.keys[f.length-1]&&(k=f[f.length-1],1<k.length))switch(k){case "<CR>":k="\n";break;case "<Space>":k=" ";break;default:continue}g.push(l)}}if(g.length){if(1==g.length)return d(g[0]);b=c.visualMode?"visual":"normal";for(var p,h=0;h<g.length;h++)if(c=g[h],c.context==b){p=c;break}else p||c.context||(p=c);return d(p)}e.keyBuffer=[];return null},processCommand:function(a,b,c){b.inputState.repeatOverride=c.repeatOverride;switch(c.type){case "motion":this.processMotion(a,b,c);break;case "operator":this.processOperator(a,
b,c);break;case "operatorMotion":this.processOperatorMotion(a,b,c);break;case "action":this.processAction(a,b,c);break;case "search":this.processSearch(a,b,c);break;case "ex":case "keyToEx":this.processEx(a,b,c)}},processMotion:function(a,b,c){b.inputState.motion=c.motion;b.inputState.motionArgs=V(c.motionArgs);this.evalInput(a,b)},processOperator:function(a,b,c){var d=b.inputState;if(d.operator){if(d.operator==c.operator){d.motion="expandToLine";d.motionArgs={linewise:!0};this.evalInput(a,b);return}P(a)}d.operator=
c.operator;d.operatorArgs=V(c.operatorArgs);b.visualMode&&this.evalInput(a,b)},processOperatorMotion:function(a,b,c){var d=b.visualMode,e=V(c.operatorMotionArgs);e&&d&&e.visualLine&&(b.visualLine=!0);this.processOperator(a,b,c);d||this.processMotion(a,b,c)},processAction:function(a,b,c){var d=b.inputState,e=d.getRepeat(),f=!!e,g=V(c.actionArgs)||{};d.selectedCharacter&&(g.selectedCharacter=d.selectedCharacter);c.operator&&this.processOperator(a,b,c);c.motion&&this.processMotion(a,b,c);(c.motion||
c.operator)&&this.evalInput(a,b);g.repeat=e||1;g.repeatIsExplicit=f;g.registerName=d.registerName;P(a);b.lastMotion=null;c.isEdit&&this.recordLastEdit(b,d,c);ca[c.action](a,g,b)},processSearch:function(a,b,c){function d(d,e,f){try{Y(a,d,e,f)}catch(g){t(a,"Invalid regex: "+d);return}L.processMotion(a,b,{type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:c.searchArgs.toJumplist}})}function e(b){a.scrollTo(r.left,r.top);d(b,!0,!0);var c=q.macroModeState;c.isRecording&&(c.isPlaying||(c=
q.registerController.getRegister(c.latestRegister))&&c.pushSearchQuery(b))}function f(b,c){var d;try{d=Y(a,c,!0,!0)}catch(e){}d?a.scrollIntoView(Ca(a,!k,d),30):(ja(a),a.scrollTo(r.left,r.top))}function g(b,c,d){c=m.keyName(b);if("Esc"==c||"Ctrl-C"==c||"Ctrl-["==c)Y(a,p),ja(a),a.scrollTo(r.left,r.top),m.e_stop(b),d(),a.focus()}if(a.getSearchCursor){var k=c.searchArgs.forward,h=c.searchArgs.wholeWordOnly;D(a).setReversed(!k);var l=k?"/":"?",p=D(a).getQuery(),r=a.getScrollInfo();switch(c.searchArgs.querySrc){case "prompt":h=
q.macroModeState;h.isPlaying?(l=h.replaySearchQueries.shift(),d(l,!0,!1)):X(a,{onClose:e,prefix:l,desc:Ya,onKeyUp:f,onKeyDown:g});break;case "wordUnderCursor":var n=W(a,!1,!0,!1,!0),y=!0;n||(n=W(a,!1,!0,!1,!1),y=!1);if(!n)break;l=a.getLine(n.start.line).substring(n.start.ch,n.end.ch);l=y&&h?"\\b"+l+"\\b":l.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1");q.jumpList.cachedCursor=a.getCursor();a.setCursor(n.start);d(l,!0,!1)}}},processEx:function(a,b,c){function d(b){I.processCommand(a,b)}function e(b,c,
d){c=m.keyName(b);if("Esc"==c||"Ctrl-C"==c||"Ctrl-["==c)m.e_stop(b),d(),a.focus()}"keyToEx"==c.type?I.processCommand(a,c.exArgs.input):b.visualMode?X(a,{onClose:d,prefix:":",value:"'<,'>",onKeyDown:e}):X(a,{onClose:d,prefix:":",onKeyDown:e})},evalInput:function(a,b){var c=b.inputState,d=c.motion,e=c.motionArgs||{},f=c.operator,g=c.operatorArgs||{},k=c.registerName,h=z(a.getCursor("head")),l=z(a.getCursor("anchor")),m=z(h),r=z(m),n,y;f&&this.recordLastEdit(b,c);y=void 0!==c.repeatOverride?c.repeatOverride:
c.getRepeat();if(0<y&&e.explicitRepeat)e.repeatIsExplicit=!0;else if(e.noRepeat||!e.explicitRepeat&&0===y)y=1,e.repeatIsExplicit=!1;c.selectedCharacter&&(e.selectedCharacter=g.selectedCharacter=c.selectedCharacter);e.repeat=y;P(a);if(d){c=M[d](a,e,b);b.lastMotion=M[d];if(!c)return;e.toJumplist&&(n=q.jumpList,(d=n.cachedCursor)?(u(d,c)||q.jumpList.add(a,d,c),delete n.cachedCursor):u(r,c)||q.jumpList.add(a,r,c));c instanceof Array?(m=c[0],n=c[1]):n=c;n||(n=p(m.line,m.ch));b.visualMode?(s(l,h)&&(u(l,
n)||s(n,l))?l.ch+=1:s(h,l)&&(u(l,n)||s(l,n))&&(l.ch-=1),h=n,l=c instanceof Array?m:l,b.visualLine&&(s(l,h)?(l.ch=0,c=a.lastLine(),h.line>c&&(h.line=c),h.ch=w(a,h.line)):(h.ch=0,l.ch=w(a,l.line))),a.setSelection(l,h),Q(a,b,"<",s(l,h)?l:h),Q(a,b,">",s(l,h)?h:l)):f||(n=H(a,n),a.setCursor(n.line,n.ch))}if(f){c=!1;b.lastMotion=null;g.repeat=y;b.visualMode&&(m=l,n=h,e.inclusive=!0);n&&s(n,m)?(h=m,m=n,n=h,c=!0):n||(n=z(m));!e.inclusive||b.visualMode&&c||n.ch++;g.selOffset?(n.line=m.line+g.selOffset.line,
n.ch=g.selOffset.line?g.selOffset.ch:m.ch+g.selOffset.ch):b.visualMode&&(h=p(),h.line=n.line-m.line,h.ch=h.line?n.ch:n.ch-m.ch,g.selOffset=h);if(h=e.linewise||b.visualMode&&b.visualLine||g.linewise)e=n,m.ch=0,e.ch=0,e.line++;else if(e.forward&&(e=n,l=a.getRange(m,e),/\n\s*$/.test(l))){l=l.split("\n");l.pop();for(y=l.pop();0<l.length&&y&&/^\s*$/.test(y);y=l.pop())e.line--,e.ch=0;y?(e.line--,e.ch=w(a,e.line)):e.ch=0}g.registerName=k;g.linewise=h;Za[f](a,g,b,m,n,r);b.visualMode&&x(a)}},recordLastEdit:function(a,
b,c){var d=q.macroModeState;d.isPlaying||(a.lastEditInputState=b,a.lastEditActionCommand=c,d.lastInsertModeChanges.changes=[],d.lastInsertModeChanges.expectCursorActivityForChange=!1)}},M={moveToTopLine:function(a,b){var c=ka(a).top+b.repeat-1;return p(c,v(a.getLine(c)))},moveToMiddleLine:function(a){var b=ka(a),b=Math.floor(.5*(b.top+b.bottom));return p(b,v(a.getLine(b)))},moveToBottomLine:function(a,b){var c=ka(a).bottom-b.repeat+1;return p(c,v(a.getLine(c)))},expandToLine:function(a,b){var c=a.getCursor();
return p(c.line+b.repeat-1,Infinity)},findNext:function(a,b){var c=D(a),d=c.getQuery();if(d){var e=!b.forward,e=c.isReversed()?!e:e;Ba(a,d);return Ca(a,e,d,b.repeat)}},goToMark:function(a,b,c){return(c=c.marks[b.selectedCharacter])?(c=c.find(),b.linewise?{line:c.line,ch:v(a.getLine(c.line))}:c):null},moveToOtherHighlightedEnd:function(a){var b=z(a.getCursor("head"));a=z(a.getCursor("anchor"));s(a,b)?b.ch+=1:s(b,a)&&(a.ch-=1);return[b,a]},jumpToMark:function(a,b,c){for(var d=a.getCursor(),e=0;e<b.repeat;e++){var f=
d,g;for(g in c.marks)if(/^[a-z]$/.test(g)){var k=c.marks[g].find();if(b.forward?!s(k,f):!s(f,k))if(!b.linewise||k.line!=f.line){var h=u(f,d),l=b.forward?wa(f,k,d):wa(d,k,f);if(h||l)d=k}}}b.linewise&&(d=p(d.line,v(a.getLine(d.line))));return d},moveByCharacters:function(a,b){var c=a.getCursor(),d=b.repeat;return p(c.line,b.forward?c.ch+d:c.ch-d)},moveByLines:function(a,b,c){var d=a.getCursor(),e=d.ch;switch(c.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:e=
c.lastHPos;break;default:c.lastHPos=e}var f=b.repeat+(b.repeatOffset||0),f=b.forward?d.line+f:d.line-f,g=a.firstLine(),k=a.lastLine();if(!(f<g&&d.line==g||f>k&&d.line==k))return b.toFirstChar&&(e=v(a.getLine(f)),c.lastHPos=e),c.lastHSPos=a.charCoords(p(f,e),"div").left,p(f,e)},moveByDisplayLines:function(a,b,c){var d=a.getCursor();switch(c.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:c.lastHSPos=a.charCoords(d,
"div").left}var e=b.repeat,d=a.findPosV(d,b.forward?e:-e,"line",c.lastHSPos);d.hitSide&&(b.forward?b={top:a.charCoords(d,"div").top+8,left:c.lastHSPos}:(b=a.charCoords(p(a.firstLine(),0),"div"),b.left=c.lastHSPos),d=a.coordsChar(b,"div"));c.lastHPos=d.ch;return d},moveByPage:function(a,b){var c=a.getCursor(),d=b.repeat;return a.findPosV(c,b.forward?d:-d,"page")},moveByParagraph:function(a,b){for(var c=a.getCursor().line,d=b.repeat,e=b.forward?1:-1,f=0;f<d&&!(!b.forward&&c===a.firstLine()||b.forward&&
c==a.lastLine());f++)for(c+=e;c!==a.firstLine()&&c!=a.lastLine()&&a.getLine(c);)c+=e;return p(c,0)},moveByScroll:function(a,b,c){var d=a.getScrollInfo(),e=null;(e=b.repeat)||(e=d.clientHeight/(2*a.defaultTextHeight()));var f=a.charCoords(a.getCursor(),"local");b.repeat=e;e=M.moveByDisplayLines(a,b,c);if(!e)return null;b=a.charCoords(e,"local");a.scrollTo(null,d.top+b.top-f.top);return e},moveByWords:function(a,b){var c;var d=b.repeat;c=!!b.forward;var e=!!b.wordEnd,f=!!b.bigWord,g=a.getCursor(),k=
z(g),h=[];(c&&!e||!c&&e)&&d++;for(var l=!(c&&e),m=0;m<d;m++){var r;b:{r=a;var n=c,q=f,s=l,t=g.line,A=g.ch,E=r.getLine(t),J=n?1:-1,q=q?Va:Ua;if(s&&""==E){t+=J;E=r.getLine(t);if(!pa(r,t)){r=null;break b}A=n?0:E.length}for(;;){if(s&&""==E){r={from:0,to:0,line:t};break b}for(var N=n=0<J?E.length:-1,u=n;A!=n;){for(var x=!1,v=0;v<q.length&&!x;++v)if(q[v].test(E.charAt(A))){for(N=A;A!=n&&q[v].test(E.charAt(A));)A+=J;u=A;x=N!=u;if(N!=g.ch||t!=g.line||u!=N+J){r={from:Math.min(N,u+1),to:Math.max(N,u),line:t};
break b}}x||(A+=J)}t+=J;if(!pa(r,t)){r=null;break b}E=r.getLine(t);A=0<J?0:E.length}throw Error("The impossible happened.");}if(!r){f=w(a,a.lastLine());h.push(c?{line:a.lastLine(),from:f,to:f}:{line:0,from:0,to:0});break}h.push(r);g=p(r.line,c?r.to-1:r.from)}d=h.length!=d;f=h[0];l=h.pop();c&&!e?(d||f.from==k.ch&&f.line==k.line||(l=h.pop()),c=p(l.line,l.from)):c&&e?c=p(l.line,l.to-1):!c&&e?(d||f.to==k.ch&&f.line==k.line||(l=h.pop()),c=p(l.line,l.to)):c=p(l.line,l.from);return c},moveTillCharacter:function(a,
b){var c=ia(a,b.repeat,b.forward,b.selectedCharacter),d=b.forward?-1:1;ya(d,b);if(!c)return null;c.ch+=d;return c},moveToCharacter:function(a,b){var c=b.repeat;ya(0,b);return ia(a,c,b.forward,b.selectedCharacter)||a.getCursor()},moveToSymbol:function(a,b){var c;c=b.repeat;var d=b.forward,e=b.selectedCharacter,f=z(a.getCursor()),g=d?1:-1,k=d?a.lineCount():-1,h=f.ch,l=f.line,m=a.getLine(l),d={lineText:m,nextCh:m.charAt(h),lastCh:null,index:h,symb:e,reverseSymb:(d?{")":"(","}":"{"}:{"(":")","{":"}"})[e],
forward:d,depth:0,curMoveThrough:!1};if(h=$a[e]){e=Na[h].init;h=Na[h].isComplete;for(e&&e(d);l!==k&&c;)d.index+=g,d.nextCh=d.lineText.charAt(d.index),d.nextCh||(l+=g,d.lineText=a.getLine(l)||"",0<g?d.index=0:(e=d.lineText.length,d.index=0<e?e-1:0),d.nextCh=d.lineText.charAt(d.index)),h(d)&&(f.line=l,f.ch=d.index,c--);c=d.nextCh||d.curMoveThrough?p(l,d.index):f}else c=f;return c||a.getCursor()},moveToColumn:function(a,b,c){b=b.repeat;c.lastHPos=b-1;c.lastHSPos=a.charCoords(a.getCursor(),"div").left;
c=a.getCursor().line;return H(a,p(c,b-1))},moveToEol:function(a,b,c){var d=a.getCursor();c.lastHPos=Infinity;b=p(d.line+b.repeat-1,Infinity);d=a.clipPos(b);d.ch--;c.lastHSPos=a.charCoords(d,"div").left;return b},moveToFirstNonWhiteSpaceCharacter:function(a){var b=a.getCursor();return p(b.line,v(a.getLine(b.line)))},moveToMatchedSymbol:function(a){var b=a.getCursor(),c=b.line,d=b.ch,e=a.getLine(c),f;do if((f=e.charAt(d++))&&-1!="()[]{}".indexOf(f)){var g=a.getTokenTypeAt(p(c,d));if("string"!==g&&"comment"!==
g)break}while(f);return f?a.findMatchingBracket(p(c,d)).to:b},moveToStartOfLine:function(a){a=a.getCursor();return p(a.line,0)},moveToLineOrEdgeOfDocument:function(a,b){var c=b.forward?a.lastLine():a.firstLine();b.repeatIsExplicit&&(c=b.repeat-a.getOption("firstLineNumber"));return p(c,v(a.getLine(c)))},textObjectManipulation:function(a,b){var c={"'":!0,'"':!0},d=b.selectedCharacter;"b"==d?d="(":"B"==d&&(d="{");var e=!b.textObjectInner;if({"(":")",")":"(","{":"}","}":"{","[":"]","]":"["}[d]){var f=
d,g=a.getCursor(),c={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/}[f],f={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{"}[f],d=a.getLine(g.line).charAt(g.ch)===f?1:0,f=a.scanForBracket(p(g.line,g.ch+d),-1,void 0,{bracketRegex:c}),c=a.scanForBracket(p(g.line,g.ch+d),1,void 0,{bracketRegex:c});if(f&&c){f=f.pos;c=c.pos;if(f.line==c.line&&f.ch>c.ch||f.line>c.line)g=f,f=c,c=g;e?c.ch+=1:f.ch+=1;e={start:f,end:c}}else e={start:g,end:g}}else if(c[d]){var c=d,d=z(a.getCursor()),k=a.getLine(d.line).split(""),
h,l;h=k.indexOf(c);d.ch<h?d.ch=h:h<d.ch&&k[d.ch]==c&&(f=d.ch,--d.ch);if(k[d.ch]!=c||f)for(h=d.ch;-1<h&&!g;h--)k[h]==c&&(g=h+1);else g=d.ch+1;if(g&&!f)for(h=g,l=k.length;h<l&&!f;h++)k[h]==c&&(f=h);g&&f?(e&&(--g,++f),e={start:p(d.line,g),end:p(d.line,f)}):e={start:d,end:d}}else if("W"===d)e=W(a,e,!0,!0);else if("w"===d)e=W(a,e,!0,!1);else return null;return[e.start,e.end]},repeatLastCharacterSearch:function(a,b){var c=q.lastChararacterSearch,d=b.repeat,e=b.forward===c.forward,f=(c.increment?1:0)*(e?
-1:1);a.moveH(-f,"char");b.inclusive=e?!0:!1;c=ia(a,d,e,c.selectedCharacter);if(!c)return a.moveH(f,"char"),a.getCursor();c.ch+=f;return c}},Za={change:function(a,b,c,d,e){q.registerController.pushText(b.registerName,"change",a.getRange(d,e),b.linewise);b.linewise?(b=e.line>a.lastLine()?"":"\n",a.replaceRange(b,d,e),a.indentLine(d.line,"smart"),d.ch=null):(b=a.getRange(d,e),/^\s*$/.test(b)||(b=/\s+$/.exec(b))&&(e=S(e,0,-b[0].length)),a.replaceRange("",d,e));ca.enterInsertMode(a,{},a.state.vim);a.setCursor(d)},
"delete":function(a,b,c,d,e){b.linewise&&e.line>a.lastLine()&&d.line>a.firstLine()&&(d.line--,d.ch=w(a,d.line));q.registerController.pushText(b.registerName,"delete",a.getRange(d,e),b.linewise);a.replaceRange("",d,e);b.linewise?a.setCursor(M.moveToFirstNonWhiteSpaceCharacter(a)):a.setCursor(d)},indent:function(a,b,c,d,e){var f=d.line;e=e.line;c=c.visualMode?b.repeat:1;for(b.linewise&&e--;f<=e;f++)for(var g=0;g<c;g++)a.indentLine(f,b.indentRight);a.setCursor(d);a.setCursor(M.moveToFirstNonWhiteSpaceCharacter(a))},
swapcase:function(a,b,c,d,e,f){c=a.getRange(d,e);for(var g="",k=0;k<c.length;k++)var h=c.charAt(k),g=g+(O(h)?h.toLowerCase():h.toUpperCase());a.replaceRange(g,d,e);b.shouldMoveCursor||a.setCursor(f)},yank:function(a,b,c,d,e,f){q.registerController.pushText(b.registerName,"yank",a.getRange(d,e),b.linewise);a.setCursor(f)}},ca={jumpListWalk:function(a,b,c){c.visualMode||(c=b.repeat,b=(b=(b=q.jumpList.move(a,b.forward?c:-c))?b.find():void 0)?b:a.getCursor(),a.setCursor(b))},scroll:function(a,b,c){if(!c.visualMode){var d=
b.repeat||1;c=a.defaultTextHeight();var e=a.getScrollInfo().top,d=c*d,e=b.forward?e+d:e-d,d=z(a.getCursor()),f=a.charCoords(d,"local");b.forward?e>f.top?(d.line+=(e-f.top)/c,d.line=Math.ceil(d.line),a.setCursor(d),f=a.charCoords(d,"local"),a.scrollTo(null,f.top)):a.scrollTo(null,e):(b=e+a.getScrollInfo().clientHeight,b<f.bottom?(d.line-=(f.bottom-b)/c,d.line=Math.floor(d.line),a.setCursor(d),f=a.charCoords(d,"local"),a.scrollTo(null,f.bottom-a.getScrollInfo().clientHeight)):a.scrollTo(null,e))}},
scrollToCursor:function(a,b){var c=a.getCursor().line,d=a.charCoords(p(c,0),"local"),c=a.getScrollInfo().clientHeight,e=d.top,d=d.bottom-e;switch(b.position){case "center":e=e-c/2+d;break;case "bottom":e=e-c+1.4*d;break;case "top":e+=.4*d}a.scrollTo(null,e)},replayMacro:function(a,b,c){var d=b.selectedCharacter;b=b.repeat;var e=q.macroModeState;"@"==d&&(d=e.latestRegister);for(;b--;){var f=a,g=c,k=e,h=q.registerController.getRegister(d),l=h.keyBuffer,p=0;k.isPlaying=!0;k.replaySearchQueries=h.searchQueries.slice(0);
for(var r=0;r<l.length;r++)for(var n=l[r],t,s;n;)t=/<\w+-.+?>|<\w+>|./.exec(n),s=t[0],n=n.substring(t.index+s.length),m.Vim.handleKey(f,s),g.insertMode&&(Ia(f,h.insertModeChanges[p++].changes,1),K(f));k.isPlaying=!1}},enterMacroRecordMode:function(a,b){q.macroModeState.enterMacroRecordMode(a,b.selectedCharacter)},enterInsertMode:function(a,b,c){if(!a.getOption("readOnly")){c.insertMode=!0;c.insertModeRepeat=b&&b.repeat||1;c=b?b.insertAt:null;if("eol"==c)c=a.getCursor(),c=p(c.line,w(a,c.line)),a.setCursor(c);
else if("charAfter"==c)a.setCursor(S(a.getCursor(),0,1));else if("firstNonBlank"==c)a.setCursor(M.moveToFirstNonWhiteSpaceCharacter(a));else if("endOfSelectedArea"==c){c=a.getCursor("head");var d=a.getCursor("anchor");c=s(d,c)?p(c.line,c.ch+1):c.line<d.line?p(d.line,0):c;a.setCursor(c);x(a)}a.setOption("keyMap","vim-insert");a.setOption("disableInput",!1);b&&b.replace?(a.toggleOverwrite(!0),a.setOption("keyMap","vim-replace"),m.signal(a,"vim-mode-change",{mode:"replace"})):(a.setOption("keyMap","vim-insert"),
m.signal(a,"vim-mode-change",{mode:"insert"}));q.macroModeState.isPlaying||(a.on("change",Da),m.on(a.getInputField(),"keydown",Ea))}},toggleVisualMode:function(a,b,c){var d=b.repeat,e=a.getCursor();c.visualMode?(e=a.getCursor("anchor"),d=a.getCursor("head"),!c.visualLine&&b.linewise?(c.visualLine=!0,e.ch=s(e,d)?0:w(a,e.line),d.ch=s(e,d)?w(a,d.line):0,a.setSelection(e,d),m.signal(a,"vim-mode-change",{mode:"visual",subMode:"linewise"})):c.visualLine&&!b.linewise?(c.visualLine=!1,m.signal(a,"vim-mode-change",
{mode:"visual"})):x(a)):(a.on("mousedown",x),c.visualMode=!0,c.visualLine=!!b.linewise,c.visualLine?(e.ch=0,d=H(a,p(e.line+d-1,w(a,e.line)),!0)):d=H(a,p(e.line,e.ch+d),!0),b.repeatIsExplicit||c.visualLine?a.setSelection(e,d):(a.setCursor(d),a.setSelection(d,e)),m.signal(a,"vim-mode-change",{mode:"visual",subMode:c.visualLine?"linewise":""}));Q(a,c,"<",s(e,d)?e:d);Q(a,c,">",s(e,d)?d:e)},reselectLastSelection:function(a,b,c){c.lastSelection&&(b=c.lastSelection,a.setSelection(b.curStart,b.curEnd),b.visualLine?
(c.visualMode=!0,c.visualLine=!0):(c.visualMode=!0,c.visualLine=!1),m.signal(a,"vim-mode-change",{mode:"visual",subMode:c.visualLine?"linewise":""}))},joinLines:function(a,b,c){var d,e;c.visualMode?(d=a.getCursor("anchor"),e=a.getCursor("head"),e.ch=w(a,e.line)-1):(b=Math.max(b.repeat,2),d=a.getCursor(),e=H(a,p(d.line+b-1,Infinity)));var f=0;a.operation(function(){for(var b=d.line;b<e.line;b++){f=w(a,d.line);var c=p(d.line+1,w(a,d.line+1)),h=a.getRange(d,c),h=h.replace(/\n\s*/g," ");a.replaceRange(h,
d,c)}b=p(d.line,f);a.setCursor(b)})},newLineAndEnterInsertMode:function(a,b,c){c.insertMode=!0;var d=z(a.getCursor());d.line!==a.firstLine()||b.after?(d.line=b.after?d.line:d.line-1,d.ch=w(a,d.line),a.setCursor(d),(m.commands.newlineAndIndentContinueComment||m.commands.newlineAndIndent)(a)):(a.replaceRange("\n",p(a.firstLine(),0)),a.setCursor(a.firstLine(),0));this.enterInsertMode(a,{repeat:b.repeat},c)},paste:function(a,b,c){var d=z(a.getCursor()),e=q.registerController.getRegister(b.registerName),
f=e.toString();if(f){if(b.matchIndent)var g=function(b){var c=b.split("\t").length-1;b=b.split(" ").length-1;return c*a.options.tabSize+1*b},k=a.getLine(a.getCursor().line),h=g(k.match(/^\s*/)[0]),k=f.replace(/\n$/,""),l=f!==k,m=g(f.match(/^\s*/)[0]),f=k.replace(/^\s*/gm,function(b){b=h+(g(b)-m);return 0>b?"":a.options.indentWithTabs?Array(Math.floor(b/a.options.tabSize)+1).join("\t"):Array(b+1).join(" ")}),f=f+(l?"\n":"");1<b.repeat&&(f=Array(b.repeat+1).join(f));(e=e.linewise)?c.visualMode?f=c.visualLine?
f.slice(0,-1):"\n"+f.slice(0,f.length-1)+"\n":b.after?(f="\n"+f.slice(0,f.length-1),d.ch=w(a,d.line)):d.ch=0:d.ch+=b.after?1:0;c.visualMode?(c=xa(a,c),b=c[0],c=c[1],q.registerController.unnamedRegister.setText(a.getRange(b,c)),a.replaceRange(f,b,c),f=a.posFromIndex(a.indexFromPos(b)+f.length-1),e&&(f.ch=0)):(a.replaceRange(f,d),e&&b.after?f=p(d.line+1,v(a.getLine(d.line+1))):e&&!b.after?f=p(d.line,v(a.getLine(d.line))):!e&&b.after?(b=a.indexFromPos(d),f=a.posFromIndex(b+f.length-1)):(b=a.indexFromPos(d),
f=a.posFromIndex(b+f.length)));a.setCursor(f)}},undo:function(a,b){a.operation(function(){va(a,m.commands.undo,b.repeat)();a.setCursor(a.getCursor("anchor"))})},redo:function(a,b){va(a,m.commands.redo,b.repeat)()},setRegister:function(a,b,c){c.inputState.registerName=b.selectedCharacter},setMark:function(a,b,c){Q(a,c,b.selectedCharacter,a.getCursor())},replace:function(a,b,c){var d=b.selectedCharacter,e=a.getCursor(),f;c.visualMode?(e=a.getCursor("start"),f=a.getCursor("end"),f=a.clipPos(p(f.line,
f.ch+1))):(f=a.getLine(e.line),b=e.ch+b.repeat,b>f.length&&(b=f.length),f=p(e.line,b));"\n"==d?(c.visualMode||a.replaceRange("",e,f),(m.commands.newlineAndIndentContinueComment||m.commands.newlineAndIndent)(a)):(b=a.getRange(e,f),b=b.replace(/[^\n]/g,d),a.replaceRange(b,e,f),c.visualMode?(a.setCursor(e),x(a)):a.setCursor(S(f,0,-1)))},incrementNumberToken:function(a,b){for(var c=a.getCursor(),d=a.getLine(c.line),e=/-?\d+/g,f,g,k,h;null!==(f=e.exec(d))&&!(h=f[0],g=f.index,k=g+h.length,c.ch<k););!b.backtrack&&
k<=c.ch||!h||(d=b.increase?1:-1,d=parseInt(h)+d*b.repeat,h=p(c.line,g),k=p(c.line,k),d=d.toString(),a.replaceRange(d,h,k),a.setCursor(p(c.line,g+d.length-1)))},repeatLastEdit:function(a,b,c){if(c.lastEditInputState){var d=b.repeat;d&&b.repeatIsExplicit?c.lastEditInputState.repeatOverride=d:d=c.lastEditInputState.repeatOverride||d;Fa(a,c,d,!1)}},changeCase:function(a,b,c){var d=xa(a,c);c=d[0];d=d[1];b=b.toLower;var e=a.getRange(c,d);a.replaceRange(b?e.toLowerCase():e.toUpperCase(),c,d);a.setCursor(c)}},
$a={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},Na={bracket:{isComplete:function(a){if(a.nextCh===a.symb){if(a.depth++,1<=a.depth)return!0}else a.nextCh===a.reverseSymb&&a.depth--;return!1}},section:{init:function(a){a.curMoveThrough=!0;a.symb=(a.forward?"]":"[")===a.symb?"{":"}"},isComplete:function(a){return 0===a.index&&a.nextCh===a.symb}},comment:{isComplete:function(a){var b="*"===a.lastCh&&
"/"===a.nextCh;a.lastCh=a.nextCh;return b}},method:{init:function(a){a.symb="m"===a.symb?"{":"}";a.reverseSymb="{"===a.symb?"}":"{"},isComplete:function(a){return a.nextCh===a.symb?!0:!1}},preprocess:{init:function(a){a.index=0},isComplete:function(a){if("#"===a.nextCh){var b=a.lineText.match(/#(\w+)/)[1];if("endif"===b){if(a.forward&&0===a.depth)return!0;a.depth++}else if("if"===b){if(!a.forward&&0===a.depth)return!0;a.depth--}if("else"===b&&0===a.depth)return!0}return!1}}};qa("pcre",!0,"boolean");
za.prototype={getQuery:function(){return q.query},setQuery:function(a){q.query=a},getOverlay:function(){return this.searchOverlay},setOverlay:function(a){this.searchOverlay=a},isReversed:function(){return q.isReversed},setReversed:function(a){q.isReversed=a}};var Ya="(Javascript regexp)",Oa=[{name:"map"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"set"},{name:"sort",
shortName:"sor"},{name:"substitute",shortName:"s"},{name:"nohlsearch",shortName:"noh"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0}];aa.ExCommandDispatcher=function(){this.buildCommandMap_()};aa.ExCommandDispatcher.prototype={processCommand:function(a,b){var c=a.state.vim,d=q.registerController.getRegister(":"),e=d.toString();c.visualMode&&x(a);var f=new m.StringStream(b);d.setText(b);var g={};g.input=b;try{this.parseInput_(a,f,g)}catch(k){throw t(a,
k),k;}var h;if(g.commandName){if(c=this.matchCommand_(g.commandName)){h=c.name;c.excludeFromCommandHistory&&d.setText(e);this.parseCommandArgs_(f,g,c);if("exToKey"==c.type){for(d=0;d<c.toKeys.length;d++)m.Vim.handleKey(a,c.toKeys[d]);return}if("exToEx"==c.type){this.processCommand(a,c.toInput);return}}}else void 0!==g.line&&(h="move");if(h)try{Ma[h](a,g)}catch(l){throw t(a,l),l;}else t(a,'Not an editor command ":'+b+'"')},parseInput_:function(a,b,c){b.eatWhile(":");b.eat("%")?(c.line=a.firstLine(),
c.lineEnd=a.lastLine()):(c.line=this.parseLineSpec_(a,b),void 0!==c.line&&b.eat(",")&&(c.lineEnd=this.parseLineSpec_(a,b)));a=b.match(/^(\w+)/);c.commandName=a?a[1]:b.match(/.*/)[0];return c},parseLineSpec_:function(a,b){var c=b.match(/^(\d+)/);if(c)return parseInt(c[1],10)-1;switch(b.next()){case ".":return a.getCursor().line;case "$":return a.lastLine();case "'":if((c=a.state.vim.marks[b.next()])&&c.find())return c.find().line;throw Error("Mark not set");default:b.backUp(1)}},parseCommandArgs_:function(a,
b,c){a.eol()||(b.argString=a.match(/.*/)[0],a=c.argDelimiter||/\s+/,a=ha(b.argString).split(a),a.length&&a[0]&&(b.args=a))},matchCommand_:function(a){for(var b=a.length;0<b;b--){var c=a.substring(0,b);if(this.commandMap_[c]&&(c=this.commandMap_[c],0===c.name.indexOf(a)))return c}return null},buildCommandMap_:function(){this.commandMap_={};for(var a=0;a<Oa.length;a++){var b=Oa[a];this.commandMap_[b.shortName||b.name]=b}},map:function(a,b,c){if(":"!=a&&":"==a.charAt(0)){if(c)throw Error("Mode not supported for ex mappings");
c=a.substring(1);":"!=b&&":"==b.charAt(0)?this.commandMap_[c]={name:c,type:"exToEx",toInput:b.substring(1),user:!0}:this.commandMap_[c]={name:c,type:"exToKey",toKeys:R(b),user:!0}}else b=":"!=b&&":"==b.charAt(0)?{keys:R(a),type:"keyToEx",exArgs:{input:b.substring(1)},user:!0}:{keys:R(a),type:"keyToKey",toKeys:R(b),user:!0},c&&(b.context=c),F.unshift(b)},unmap:function(a,b){var c=function(a,b){if(a===b||null==a||null==b)return!0;if(a.length!=b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;
return!0};if(":"!=a&&":"==a.charAt(0)){if(b)throw Error("Mode not supported for ex mappings");c=a.substring(1);if(this.commandMap_[c]&&this.commandMap_[c].user){delete this.commandMap_[c];return}}else for(var d=R(a),e=0;e<F.length;e++)if(c(d,F[e].keys)&&F[e].context===b&&F[e].user){F.splice(e,1);return}throw Error("No such mapping.");}};var Ma={map:function(a,b,c){var d=b.args;!d||2>d.length?a&&t(a,"Invalid mapping: "+b.input):I.map(d[0],d[1],c)},nmap:function(a,b){this.map(a,b,"normal")},vmap:function(a,
b){this.map(a,b,"visual")},unmap:function(a,b,c){var d=b.args;!d||1>d.length?a&&t(a,"No such mapping: "+b.input):I.unmap(d[0],c)},move:function(a,b){L.processCommand(a,a.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:b.line+1})},set:function(a,b){var c=b.args;if(!c||1>c.length)a&&t(a,"Invalid mapping: "+b.input);else{var d=c[0].split("="),c=d[0],d=d[1],e=!1;if("?"==c.charAt(c.length-1)){if(d)throw Error("Trailing characters: "+
b.argString);c=c.substring(0,c.length-1);e=!0}void 0===d&&"no"==c.substring(0,2)&&(c=c.substring(2),d=!1);var f=G[c]&&"boolean"==G[c].type;f&&void 0==d&&(d=!0);!f&&!d||e?(d=T(c),!0===d||!1===d?t(a," "+(d?"":"no")+c):t(a,"  "+c+"="+d)):fa(c,d)}},registers:function(a,b){var c=b.args,d=q.registerController.registers,e="----------Registers----------<br><br>";if(c)for(var c=c.join(""),f=0;f<c.length;f++){if(k=c.charAt(f),q.registerController.isValidRegister(k))var g=d[k]||new C,e=e+('"'+k+"    "+g.toString()+
"<br>")}else for(var k in d)c=d[k].toString(),c.length&&(e+='"'+k+"    "+c+"<br>");t(a,e)},sort:function(a,b){function c(a,b){if(d){var c;c=a;a=b;b=c}e&&(a=a.toLowerCase(),b=b.toLowerCase());c=g&&q.exec(a);var f=g&&q.exec(b);if(!c)return a<b?-1:1;c=parseInt((c[1]+c[2]).toLowerCase(),r);f=parseInt((f[1]+f[2]).toLowerCase(),r);return c-f}var d,e,f,g,k=function(){if(b.argString){var a=new m.StringStream(b.argString);a.eat("!")&&(d=!0);if(!a.eol()){if(!a.eatSpace())return"Invalid arguments";var c=a.match(/[a-z]+/);
if(c){c=c[0];e=-1!=c.indexOf("i");f=-1!=c.indexOf("u");var h=-1!=c.indexOf("d")&&1,k=-1!=c.indexOf("x")&&1,c=-1!=c.indexOf("o")&&1;if(1<h+k+c)return"Invalid arguments";g=h&&"decimal"||k&&"hex"||c&&"octal"}if(a.eatSpace()&&a.match(/\/.*\//))return"patterns not supported"}}}();if(k)t(a,k+": "+b.argString);else{var k=b.line||a.firstLine(),h=b.lineEnd||b.line||a.lastLine();if(k!=h){var k=p(k,0),h=p(h,w(a,h)),l=a.getRange(k,h).split("\n"),q="decimal"==g?/(-?)([\d]+)/:"hex"==g?/(-?)(?:0x)?([0-9a-f]+)/i:
"octal"==g?/([0-7]+)/:null,r="decimal"==g?10:"hex"==g?16:"octal"==g?8:null,n=[],s=[];if(g)for(var u=0;u<l.length;u++)q.exec(l[u])?n.push(l[u]):s.push(l[u]);else s=l;n.sort(c);s.sort(c);l=d?n.concat(s):s.concat(n);if(f)for(var n=l,v,l=[],u=0;u<n.length;u++)n[u]!=v&&l.push(n[u]),v=n[u];a.replaceRange(l.join("\n"),k,h)}}},substitute:function(a,b){if(!a.getSearchCursor)throw Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var c=b.argString,
d=c?Aa(c):[],e="";if(d.length){if(0!==d[0]){t(a,"Substitutions should be of the form :s/pattern/replace/");return}var f=c.substring(d[0]+1,d[1]),g,k,h=!1;if(d[1]){e=c.substring(d[1]+1,d[2]);if(T("pcre")){for(var e=new m.StringStream(e),l=[];!e.eol();){for(;e.peek()&&"\\"!=e.peek();)l.push(e.next());e.match("\\/",!0)?l.push("/"):e.match("\\\\",!0)?l.push("\\"):l.push(e.next())}e=l.join("")}else{for(var l=!1,s=[],r=-1;r<e.length;r++){var n=e.charAt(r)||"",u=e.charAt(r+1)||"";l?(s.push(n),l=!1):"\\"===
n?(l=!0,Ja.test(u)||"$"===u?s.push("$"):"/"!==u&&"\\"!==u&&s.push("\\")):("$"===n&&s.push("$"),s.push(n),"/"===u&&s.push("\\"))}e=s.join("")}q.lastSubstituteReplacePart=e}d[2]&&(k=c.substring(d[2]+1).split(" "),g=k[0],k=parseInt(k[1]));g&&(-1!=g.indexOf("c")&&(h=!0,g.replace("c","")),f=f+"/"+g)}if(f)try{Y(a,f,!0,!0)}catch(v){t(a,"Invalid regex: "+f);return}e=e||q.lastSubstituteReplacePart;void 0===e?t(a,"No previous substitute regular expression"):(f=D(a).getQuery(),g=void 0!==b.line?b.line:a.getCursor().line,
c=b.lineEnd||g,k&&(g=c,c=g+k-1),k=H(a,p(g,0)),k=a.getSearchCursor(f,k),Ta(a,h,g,c,k,f,e))},redo:m.commands.redo,undo:m.commands.undo,write:function(a){m.commands.save?m.commands.save(a):a.save()},nohlsearch:function(a){ja(a)},delmarks:function(a,b){if(b.argString&&ha(b.argString))for(var c=a.state.vim,d=new m.StringStream(ha(b.argString));!d.eol();){d.eatSpace();var e=d.pos;if(!d.match(/[a-zA-Z]/,!1)){t(a,"Invalid argument: "+b.argString.substring(e));break}var f=d.next();if(d.match("-",!0)){if(!d.match(/[a-zA-Z]/,
!1)){t(a,"Invalid argument: "+b.argString.substring(e));break}var g=d.next();if(/^[a-z]$/.test(f)&&/^[a-z]$/.test(g)||O(f)&&O(g)){f=f.charCodeAt(0);g=g.charCodeAt(0);if(f>=g){t(a,"Invalid argument: "+b.argString.substring(e));break}for(e=0;e<=g-f;e++){var k=String.fromCharCode(f+e);delete c.marks[k]}}else{t(a,"Invalid argument: "+f+"-");break}}else delete c.marks[f]}else t(a,"Argument required")}},I=new aa.ExCommandDispatcher;m.keyMap.vim=function(){function a(a){return function(b){m.signal(b,"vim-keypress",
a);m.Vim.handleKey(b,a)}}function b(b,e){for(var f=0;f<b.length;f++){var g=b[f];e||1!=g.length||(g="'"+g+"'");var k=e,h=b[f];O(h)&&"Ctrl"==k&&(h=h.toLowerCase());k&&(h=k.charAt(0)+"-"+h);h=(k={Enter:"CR",Backspace:"BS",Delete:"Del"}[h])?k:h;h=1<h.length?"<"+h+">":h;c[e?e+"-"+g:g]=a(h)}}var c={nofallthrough:!0,style:"fat-cursor"};b(Z);b(ma);b(Z,"Ctrl");b(Ka);b(Ka,"Ctrl");b($);b($,"Ctrl");b(La);b(La,"Ctrl");return c}();var ba;m.keyMap["vim-insert"]={Esc:K,"Ctrl-[":K,"Ctrl-C":K,"Ctrl-N":"autocomplete",
"Ctrl-P":"autocomplete",Enter:function(a){(m.commands.newlineAndIndentContinueComment||m.commands.newlineAndIndent)(a)},K:function(a){a.replaceRange("k",a.getCursor(),a.getCursor(),"+input");a.setOption("keyMap","await-j");ba=!0;setTimeout(function(){!0==ba&&(ba=!1,a.setOption("keyMap","vim-insert"))},100)},fallthrough:["default"]};m.keyMap["await-j"]={J:function(a){ba=!1;a.replaceRange("",{ch:a.getCursor().ch-1,line:a.getCursor().line},a.getCursor(),"+input");K(a)},fallthrough:["vim-insert"]};m.keyMap["vim-replace"]=
{Backspace:"goCharLeft",fallthrough:["vim-insert"]};ta();return Xa};m.Vim=aa()});